<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}College Management System{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    {% if current_user.is_authenticated %}
    <nav class="navbar">
        <div class="nav-brand">
            <a href="{{ url_for('dashboard.index') }}">College Management</a>
        </div>
        <ul class="nav-links">
            <li><a href="{{ url_for('dashboard.index') }}">Dashboard</a></li>

            {% if current_user.is_student() %}
            <li><a href="{{ url_for('attendance.my_attendance') }}">Attendance</a></li>
            <li><a href="{{ url_for('marks.my_results') }}">Results</a></li>
            <li><a href="{{ url_for('fees.my_fees') }}">Fees</a></li>
            <li><a href="{{ url_for('timetable.my_timetable') }}">Timetable</a></li>
            <li><a href="{{ url_for('library.my_books') }}">Library</a></li>
            <li><a href="{{ url_for('complaints.my_complaints') }}">Complaints</a></li>
            <li><a href="{{ url_for('feedback.my_feedback') }}">Feedback</a></li>
            {% endif %}

            {% if current_user.is_staff() and not current_user.is_hod() %}
            <li><a href="{{ url_for('attendance.reports') }}">Attendance</a></li>
            <li><a href="{{ url_for('marks.manage') }}">Marks</a></li>
            <li><a href="{{ url_for('students.list') }}">Students</a></li>
            <li><a href="{{ url_for('usermanagement.subject_list') }}">Subjects</a></li>
            <li><a href="{{ url_for('timetable.staff_schedule') }}">My Schedule</a></li>
            <li><a href="{{ url_for('complaints.assigned') }}">Complaints</a></li>
            <li><a href="{{ url_for('feedback.staff_feedback') }}">Feedback</a></li>
            {% endif %}

            {% if current_user.is_hod() %}
            <li><a href="{{ url_for('usermanagement.staff_list') }}">Manage Staff</a></li>
            <li><a href="{{ url_for('usermanagement.assignment_list') }}">Staff Assign</a></li>
            <li><a href="{{ url_for('usermanagement.hod_student_list') }}">Students</a></li>
            <li><a href="{{ url_for('usermanagement.subject_list') }}">Subjects</a></li>
            {% endif %}

            {% if current_user.is_management() %}
            <li><a href="{{ url_for('usermanagement.department_list') }}">Departments</a></li>
            <li><a href="{{ url_for('usermanagement.hod_list') }}">Manage HODs</a></li>
            <li><a href="{{ url_for('fees.structure') }}">Fee Structure</a></li>
            <li><a href="{{ url_for('notices.manage') }}">Notices</a></li>
            <li><a href="{{ url_for('complaints.all') }}">Complaints</a></li>
            <li><a href="{{ url_for('library.manage') }}">Library</a></li>
            {% endif %}

            <li><a href="{{ url_for('notices.index') }}">Notices</a></li>
            <li class="notification-link">
                <a href="{{ url_for('notifications.index') }}">
                    Notifications
                    {% if unread_count is defined and unread_count > 0 %}
                    <span class="badge">{{ unread_count }}</span>
                    {% endif %}
                </a>
            </li>
        </ul>
        <div class="nav-user">
            <span>{{ current_user.get_display_name() }} ({{ current_user.role|title }})</span>
            <a href="{{ url_for('auth.logout') }}" class="btn btn-logout">Logout</a>
        </div>
    </nav>
    {% endif %}

    <main class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="alert alert-{{ category }}">
                    {{ message }}
                    <button type="button" class="close-btn" onclick="this.parentElement.remove()">&times;</button>
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <footer class="footer">
        <p>&copy; 2024 College Management System. All rights reserved.</p>
    </footer>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>
